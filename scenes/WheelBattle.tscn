[gd_scene load_steps=12 format=2]

[ext_resource path="res://scripts/game/wheel_battle.gd" type="Script" id=1]
[ext_resource path="res://scenes/Wheel.tscn" type="PackedScene" id=2]
[ext_resource path="res://assets/tiles/0x72_DungeonTileset/frames/knight_m_idle_anim_f0.png" type="Texture" id=3]
[ext_resource path="res://assets/ScreenSeparator.png" type="Texture" id=4]
[ext_resource path="res://assets/tiles/0x72_DungeonTileset/frames/big_demon_idle_anim_f0.png" type="Texture" id=5]
[ext_resource path="res://shaders/FadeMaterial.tres" type="Material" id=6]
[ext_resource path="res://assets/ScreenSeparatorOverlay.png" type="Texture" id=7]

[sub_resource type="Shader" id=4]
code = "shader_type canvas_item;

uniform float slider : hint_range(0, 1) = 1.0;
uniform sampler2D overlay;

void fragment() {
	if (UV.x > slider) {
		COLOR = vec4(0, 0, 0, 0);
	} else {
		vec4 tex_color = texture(TEXTURE, UV);
		vec4 overlay_color = texture(overlay, UV + (vec2(0, 1) * TIME));
		
		COLOR = overlay_color;
		COLOR.a = tex_color.a;
	}
}"

[sub_resource type="ShaderMaterial" id=5]
shader = SubResource( 4 )
shader_param/slider = 1.0
shader_param/overlay = ExtResource( 7 )

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float fade_amount : hint_range(0, 1) = 1.0;

void fragment() {
	vec4 color = texture(TEXTURE, UV);
	COLOR = vec4(color.r, color.g, color.b, color.a * fade_amount);
}"

[sub_resource type="ShaderMaterial" id=3]
resource_local_to_scene = true
shader = SubResource( 1 )
shader_param/fade_amount = 1.0

[node name="WheelBattle" type="Node2D"]
script = ExtResource( 1 )

[node name="Background" type="ColorRect" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
margin_right = 1024.0
margin_bottom = 600.0
color = Color( 0, 0, 0, 0.101961 )

[node name="Tween" type="Tween" parent="Background"]

[node name="ScreenSeparator" type="Sprite" parent="."]
material = SubResource( 5 )
position = Vector2( 512, 300 )
texture = ExtResource( 4 )

[node name="Tween" type="Tween" parent="ScreenSeparator"]

[node name="Attacking" type="Node2D" parent="."]

[node name="AttackWheel" parent="Attacking" instance=ExtResource( 2 )]
position = Vector2( 128, 472 )
rotation = 0.785398
scale = Vector2( 0.75, 0.75 )

[node name="AttackingUnit" type="Sprite" parent="Attacking"]
material = ExtResource( 6 )
position = Vector2( 440, 496 )
scale = Vector2( 5, 5 )
texture = ExtResource( 3 )

[node name="Tween" type="Tween" parent="Attacking"]

[node name="Defending" type="Node2D" parent="."]

[node name="DefenseWheel" parent="Defending" instance=ExtResource( 2 )]
position = Vector2( 876, 128 )
rotation = -2.35619
scale = Vector2( 0.75, 0.75 )

[node name="DefendingUnit" type="Sprite" parent="Defending"]
material = SubResource( 3 )
position = Vector2( 576, 88 )
scale = Vector2( 5, 5 )
texture = ExtResource( 5 )
flip_h = true

[node name="Tween" type="Tween" parent="Defending"]

[node name="Button" type="Button" parent="."]
margin_left = 72.0
margin_top = 8.0
margin_right = 122.0
margin_bottom = 28.0
text = "Start"

[node name="Button2" type="Button" parent="."]
margin_left = 128.0
margin_top = 8.0
margin_right = 178.0
margin_bottom = 28.0
text = "Reset"

[connection signal="pressed" from="Button" to="." method="animate_in"]
[connection signal="pressed" from="Button2" to="." method="_reset_vars"]
